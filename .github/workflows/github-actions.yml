name: docker-run-tests
on: 
  push: 
    branches: [master]
jobs: 
  run-tests: 
    runs-on: ubuntu-latest 
    name: Run React tests 
    steps: 
      - name: Check out Repo 
        uses: actions/checkout@v2 
      - name: Login to Docker Hub 
        uses: docker/login-action@v1
        with: 
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
      - name: Set up Docker Buildx 
        id: buildx 
        uses: docker/setup-buildx-action@v1 
      - name: build 
        run: docker build -t alinisarahmed/docker-react-temp -f Dockerfile.dev . 
      - name: test 
        run: docker run -e CI=true alinisarahmed/docker-react-temp npm run test
      - name: Tag our Image
        run: docker tag alinisarahmed/docker-react-temp alinisarahmed/docker-react-temp:latest
      - name: Push to Docker Hub 
        run: docker push alinisarahmed/docker-react-temp
      - name: Deploy 
        uses: emoneymeets/action-beanstalk-deploy@master
        with: 
          aws_access_key_id: ${{ secrets.AWS_ACCESS_KEY }}
          aws_secret_access_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          config_path: "${{ format('configs/{0}.json', 'prod') }}"
          aws_region: us-west-2
